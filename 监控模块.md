数据采集接口

数据上报接口

数据存储和计算



数据采集有两种方式

* 方式一：整个过程采集两次（温度，内存，电量）
* 方式二：在执行每次任务的时候前后采集两次（CPU使用率）



现阶段的想法是

* ~~针对每一个监控模块自己存储相应的数据~~
* 单独设计一种数据结构，每一个监控模块复杂采样，把数据放到里面去。而Service负责初始化该结构。这样做可以在Service执行任务失败了，也能把数据上报上去

数据的格式

* ```java
  map<String,int>
  ```

  这种方式有点很明显，就是数据存储方便，但是不能记录当前Service的状态，比如正在执行何种任务，

* 类比Test，那边是用一个Result来封住结果，再把结构发送给benchmarkBL。

  针对数据的存储的格式，对两种采样方式进行区别，方式一可以通过单独的数据结构进行存储，但是方式二还是需要集成到Result中(这样就不符合我的预期了)

* 另一种方法，默认添加两个测试，开始和结束测试，并将测试结果加入到原本的result中

```java
public class BenchmarkMonitorBase{
  String Monitor_name;
  public BenchmarkMonitorResult smaple();//把数据打到对应的数据结构中
  public static List<BenchmarkMonitorBase> initBenchmarkMonitor(){return null;}
}
```

如何初始化？

​	通过BenchmarkMonitorBase的init进行初始化，但当监控指标变多后会变得比较繁杂

如何循环调用？

```java
//针对方式一
Service{
  List<BenchmarkMonitorResult> BenchmarkMonitorResults = new ArrayList<>();
  List<BenchmarkMonitorBase> BenchmarkMonitors = BenchmarkMonitorBase::initBenchmarkMonitor();
  for(BenchmarkMonitorBase BenchmarkMonitor : BenchmarkMonitors){
    BenchmarkMonitorResults.add(BenchmarkMonitor.sample());
  }
}
```

方式二和方式一的区别在于方式二需要和对应的taskresult进行绑定。



数据上报方式：

现阶段性能监控的上报方式和benchmark的上报方式是分开的，如果是合在一起的话，就不需要针对CPU这样的采集方式进行单独的区分。如果性能监控是单独上报的话，就要针对方式二要额外增加数据接口，但是如果有多个方式二采集的数据，是否可以将这些数据结合到一起。



预期效果

```json
{
  "Memory":["before":89%,"after":89%],
  "CPU":12,
  "CPU":[
    "task_name":["before":89.6%,"after":70.3%],
    "task_name2":["before":89.6%,"after":70.3%]
  ],
  "temperature":["before":38.6,"after":40.5]，
	"power":["before":38.6,"after":40.5]
}

```

那么根据上述的方案，设计一个result格式

```java
Map<String,map<String,Result>>
  
inner class Result{
  int before;
  int after;
}
```





